# LandTiger (LPC1768) — Bare-Metal Template (Keil uVision / CMSIS)

Bare-metal starter project for the **LandTiger board (NXP LPC1768, ARM Cortex-M3)** using **Keil MDK-ARM (uVision)** and CMSIS.  
The template is **interrupt-driven**: the `main()` sets up peripherals, enables low-power mode, and then sleeps (`WFI`) while the application logic runs in IRQ handlers.

---

## What’s included

### Peripherals / drivers
- **LEDs** on **P2.0 … P2.7** (`Source/led/`)
- **Buttons** via **External Interrupts** **EINT0/EINT1/EINT2** with **debounce** using **Timer 3** (`Source/button_EXINT/`, `Source/timer/`)
- **Joystick** on **P1.25 … P1.29** read in polling inside the **RIT** interrupt (`Source/joystick/`, `Source/RIT/`)
- **ADC (potentiometer)** on **P1.31 = AD0.5** (`Source/adc/`) *(disabled by default in `sample.c`)*
- **DAC (speaker)** on **P0.26 = AOUT** driven by a sine lookup table via **Timer 2** (`Source/dac/`, `Source/timer/`) *(disabled by default in `sample.c`)*

### Documentation shipped with the repo
- `ARM_board.pdf` (board/cheat-sheet notes)
- `Landtiger Schematic.pdf`
- `LPC176x_userManual.pdf`

---

## Repository layout

- `sample.uvprojx` — Keil uVision project
- `Source/` — application + drivers
  - `sample.c` — main entry point + init
  - `startup_LPC17xx.s`, `system_LPC17xx.c` — startup/system
  - `adc/`, `dac/`, `button_EXINT/`, `joystick/`, `led/`, `RIT/`, `timer/`
  - `CMSIS_core/` — CMSIS headers
- `RTE/`, `DebugConfig/` — Keil Runtime Environment + debug config
- `Objects/`, `Listings/` — build artifacts (generated by Keil)

---

## Requirements

- **Keil uVision5 / MDK-ARM**
- Device pack for **LPC1768**
- Debug option:
  - **Simulator** or
  - **ULINK2/ME** (or compatible probe)

---

## Build & run (Keil)

1. Open `sample.uvprojx`
2. Select a target:
   - `LandTiger_LPC1768 (release)` for hardware
   - `SW_Debug` for simulator (**defines `SIMULATOR`**)
3. Build (`F7`)
4. Start Debug and Run

> In Keil: *Options for Target → Debug*  
> - Dialog DLL: `DARMP1.DLL` (Simulator) or `TARMP1.DLL` (ULINK2/ME)  
> - Parameter: `-pLPC1768`

---

## How the template works

In `Source/sample.c`:
- Calls `SystemInit()`
- Initializes:
  - buttons (EINT),
  - **Timer 3** for button debouncing (configured for ~50 ms),
  - joystick GPIO,
  - **RIT** (configured for ~50 ms),
  - LEDs
- Sets **power-down mode** + `SLEEPONEXIT`
- Executes `WFI`

The “application” is therefore intended to live in:
- `Source/button_EXINT/IRQ_button.c` (EINTx handlers)
- `Source/timer/IRQ_timer.c` (Timers 0..3 handlers)
- `Source/RIT/IRQ_RIT.c` (RIT handler)
- `Source/adc/IRQ_adc.c` (ADC handler)

---

## Enabling ADC + DAC (potentiometer → LEDs + tone)

By default `ADC_init()` and `DAC_init()` are commented out in `sample.c`.

1. **Enable init** in `Source/sample.c`:
   - Uncomment:
     - `ADC_init();`
     - `DAC_init();`

2. **Trigger conversions** (optional, but typical):
   - In `Source/RIT/IRQ_RIT.c`, uncomment:
     - `ADC_start_conversion();`

3. **What happens then**
- `ADC_IRQHandler()` reads `ADGDR`, maps the value to **0..7**, updates the LEDs, and reconfigures **Timer 2** period using the `freqs[]` table.
- `TIMER2_IRQHandler()` outputs samples from `SinTable[45]` to the DAC (`DACR`) to generate the tone.

---

## Pin mapping (quick reference)

- **LEDs:** `P2.0 … P2.7`
- **Buttons (EINT):**
  - `P2.10` → `EINT0` (INT0)
  - `P2.11` → `EINT1` (KEY1)
  - `P2.12` → `EINT2` (KEY2)
- **Joystick:**
  - `P1.25` JOY_SEL (click)
  - `P1.26` JOY_DOWN
  - `P1.27` JOY_LEFT
  - `P1.28` JOY_RIGHT
  - `P1.29` JOY_UP
- **ADC (potentiometer):** `P1.31 = AD0.5`
- **DAC (speaker):** `P0.26 = AOUT`

---

## Timing & IRQ priorities (as configured in code)

- Timers are assumed at **25 MHz** (default PCLK), **RIT at 100 MHz** (CCLK)
- Priorities set in drivers:
  - `EINT2=1`, `EINT1=2`, `EINT0=3`
  - `RIT=4`
  - `ADC=1`, `TIMER2=1` (note: same priority)
